include_partial 'fixtures'
include_partial "admin_login"

open '/admin/racers'
assert_element_present 'export_button'
assert_element_present 'include'
assert_value 'include', 'members_only'
assert_element_present 'format'
assert_value 'format', 'xls'

click 'export_button'
wait_for_not_location "glob:*/admin/racers.xls?excel_layout=xls&include=members_only"
assert_text_not_present 'error'

open '/admin/teams'
assert_text_not_present 'error'
assert_location '*/admin/teams'

open '/admin/racers'
assert_text_not_present 'error'
assert_location '*/admin/racers'

type 'name', 'tonkin'
submit_and_wait 'search_form'
wait_for_text_present "Erik Tonkin"
assert_text_not_present 'error'
assert_text_present 'Erik Tonkin'
assert_text_present 'Kona'
assert_text_present '102'
assert_value 'name', 'tonkin'

type 'include', 'all'
type 'format', 'ppl'
click 'export_button'
wait_for_not_location "glob:*/admin/racers.ppl?excel_layout=ppl&include=all"
assert_text_not_present 'error'

type 'include', 'members_only'
type 'format', 'scoring_sheet'
click 'export_button'
wait_for_not_location "glob:*/admin/racers.xls?excel_layout=scoring_sheet&include=members_only"
assert_text_not_present 'error'

type 'name', 'tonkin'
submit_and_wait 'search_form'
assert_text_not_present 'error'
assert_text_present 'Erik Tonkin'
assert_text_present 'Kona'
assert_text_present '102'
assert_value 'name', 'tonkin'
