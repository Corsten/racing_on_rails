include_partial "fixtures"
include_partial "admin_login"

open "/admin/velodromes"
assert_text_not_present "regexp:Template is missing|Unknown action|Routing Error|RuntimeError|error occurred|Application Trace|RecordNotFound"
assert_not_title "regexp:Exception"

assert_table "velodromes_table", 1, 0, "glob:Alpenrose Dairy*"
assert_table "velodromes_table", 1, 1, "glob:http://www.obra.org/track/*"
assert_table "velodromes_table", 2, 0, "glob:Valley Preferred Cycling Center*"
assert_table "velodromes_table", 2, 1, "glob:http://www.lvvelo.org/*"

click "velodrome_#{Velodrome.find_by_name('Valley Preferred Cycling Center').id}_website"
wait_for_element_present "css=.editor_field"
type "css=.editor_field", "http://example.com"
submit "css=.inplaceeditor-form"
wait_for_element_not_present "css=.editor_field"

refresh_and_wait
assert_table "velodromes_table", 2, 1, "glob:http://example.com*"

click_and_wait "css=a[href='/admin/velodromes/#{Velodrome.find_by_name('Valley Preferred Cycling Center').id}/edit']"
assert_value "velodrome_name", "Valley Preferred Cycling Center"
assert_value "velodrome_website", "http://example.com"
assert_text_not_present "regexp:Template is missing|Unknown action|Routing Error|RuntimeError|error occurred|Application Trace|RecordNotFound"
assert_not_title "regexp:Exception"

type "velodrome_name", "T-Town"
click_and_wait("save")

assert_text_not_present "regexp:Template is missing|Unknown action|Routing Error|RuntimeError|error occurred|Application Trace|RecordNotFound"
assert_not_title "regexp:Exception"

assert_value "velodrome_name", "T-Town"
