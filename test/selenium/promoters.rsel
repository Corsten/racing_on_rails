include_partial "fixtures"
include_partial "admin_login"

open "/admin/promoters"
assert_text_not_present "regexp:Template is missing|Unknown action|Routing Error|RuntimeError|error occurred|Application Trace|RecordNotFound"
assert_not_title "regexp:Exception"

assert_table "promoters_table", 1, 0, "glob:Brad Ross*"
assert_table "promoters_table", 2, 0, "glob:Candi Murray*"
assert_table "promoters_table", 2, 1, "glob:(503) 555-1212*"
assert_table "promoters_table", 3, 1, "glob:(503) 223-3343*"
assert_table "promoters_table", 3, 2, "glob:sixhobsons@comcast.net*"

click "promoter_#{Promoter.find_by_name('Candi Murray').id}_phone"
wait_for_element_present "css=.editor_field"
type "css=.editor_field", "411"
submit "css=.inplaceeditor-form"
wait_for_element_not_present "css=.editor_field"

refresh_and_wait
assert_table "promoters_table", 2, 1, "glob:411*"

click_and_wait "css=a[href='/admin/promoters/#{Promoter.find_by_name('Candi Murray').id}/edit']"
assert_value "promoter_name", "Candi Murray"
assert_value "promoter_email", "candi@obra.org"
assert_value "promoter_phone", "411"
assert_text_present "Tuesday Night PIR"
assert_text_not_present "regexp:Template is missing|Unknown action|Routing Error|RuntimeError|error occurred|Application Trace|RecordNotFound"
assert_not_title "regexp:Exception"

type "promoter_email", "cmurray@obra.net"
click_and_wait "save"

assert_text_not_present "regexp:Template is missing|Unknown action|Routing Error|RuntimeError|error occurred|Application Trace|RecordNotFound"
assert_not_title "regexp:Exception"

assert_value "promoter_email", "cmurray@obra.net"
