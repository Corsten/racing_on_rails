include_partial "fixtures"
include_partial "admin_login"

open "/admin/first_aid_providers"
assert_no_text "regexp:Template is missing|Unknown action|Routing Error|RuntimeError|error occurred|Application Trace|RecordNotFound"
assert_not_title "regexp:Exception"

assert_table "events_table", 1, 0, "glob:-------------*"
assert_table "events_table", 1, 2, "glob:Lost Series*"
assert_table "events_table", 2, 2, "glob:National Federation Event*"
assert_table "events_table", 1, 3, "glob:Brad Ross*"

assert_element_present "xpath=//table[@id='events_table']//tr[2]//td[@class='name']//div[@class='record']//div[@class='in_place_editable']"
click "xpath=//table[@id='events_table']//tr[2]//td[@class='name']//div[@class='record']//div[@class='in_place_editable']"
wait_for_element_present "css=.editor_field"
type "css=.editor_field", "Megan Weaver"
submit "css=.inplaceeditor-form"
wait_for_element_not_present "css=.editor_field"

refresh_and_wait
assert_table "events_table", 1, 0, "glob:Megan Weaver*"

click "past_events"
wait_for_text_present "Copperopolis"
assert_no_text "regexp:Template is missing|Unknown action|Routing Error|RuntimeError|error occurred|Application Trace|RecordNotFound"
assert_table "events_table", 1, 2, "glob:Copperopolis*"

click "past_events"
wait_for_text_not_present "Copperopolis"
assert_no_text "regexp:Template is missing|Unknown action|Routing Error|RuntimeError|error occurred|Application Trace|RecordNotFound"
assert_no_text "Copperopolis"

assert_table "events_table", 1, 2, "glob:Lost Series*"
assert_table "events_table", 2, 2, "glob:National Federation Event*"

# Table already sorted by date ascending, so click doesn't change order
click "css=th.date a"
pause 1000
assert_table "events_table", 1, 2, "glob:Lost Series*"
assert_table "events_table", 2, 2, "glob:National Federation Event*"

click "css=th.date a"
pause 1000
assert_table "events_table", 1, 2, "glob:National Federation Event*"
assert_table "events_table", 2, 2, "glob:Lost Series*"

click "css=th.date a"
pause 1000
assert_table "events_table", 1, 2, "glob:Lost Series*"
assert_table "events_table", 2, 2, "glob:National Federation Event*"
