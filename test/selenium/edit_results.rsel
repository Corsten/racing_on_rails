include_partial "fixtures"
include_partial "admin_login"

click "link=Copperopolis Road Race", :wait_for => :page
assert_no_text "regexp:Template is missing|Unknown action|Routing Error|RuntimeError|error occurred|Application Trace|RecordNotFound"
assert_not_title "regexp:Exception"

click "link=Senior Men Pro 1/2", :wait_for => :page
assert_no_text "regexp:Template is missing|Unknown action|Routing Error|RuntimeError|error occurred|Application Trace|RecordNotFound"
assert_not_title "regexp:Exception"

click "result_#{Event.find_by_name('Copperopolis Road Race').races.first.results.first.id}_place"
wait_for_element_present "css=.editor_field"
type "css=.editor_field", "DNF"
submit "css=.inplaceeditor-form"
wait_for_element_not_present "css=.editor_field"

refresh_and_wait
assert_no_text "13"
assert_text_present "DNF"

click "result_#{Event.find_by_name('Copperopolis Road Race').races.first.results.first.id}_name"
wait_for_element_present "css=.editor_field"
type "css=.editor_field", "Megan Weaver"
submit "css=.inplaceeditor-form"
wait_for_element_not_present "css=.editor_field"

refresh_and_wait
assert_no_text "Ryan Weaver"
assert_text_present "Megan Weaver"

click "result_#{Event.find_by_name('Copperopolis Road Race').races.first.results.first.id}_team_name"
wait_for_element_present "css=.editor_field"
type "css=.editor_field", "River City"
submit "css=.inplaceeditor-form"
wait_for_element_not_present "css=.editor_field"

refresh_and_wait
assert_text_present "River City"

click "result_#{Event.find_by_name('Copperopolis Road Race').races.first.results.first.id}_add"
click "result_#{Event.find_by_name('Copperopolis Road Race').races.first.results.first.id}_destroy"
wait_for_element_not_present "result_#{Event.find_by_name('Copperopolis Road Race').races.first.results.first.id.id}_add"
refresh_and_wait
assert_no_text "Megan Weaver"
assert_text_present "DNF"

click "result__add"
wait_for_element_present "//table[@id='results_table']//tr[1]"
refresh_and_wait
assert_text_present "Field Size (2)"

assert_value "race_laps", ""
type "race_laps", "12"

click "save", :wait_for => :page
assert_no_text "regexp:Template is missing|Unknown action|Routing Error|RuntimeError|error occurred|Application Trace|RecordNotFound"
assert_not_title "regexp:Exception"

assert_value "race_laps", "12"
