include_partial "fixtures"
include_partial "admin_login"

click_and_wait "link=Copperopolis Road Race"
assert_text_not_present "regexp:Template is missing|Unknown action|Routing Error|RuntimeError|error occurred|Application Trace|RecordNotFound"
assert_not_title "regexp:Exception"

click_and_wait "link=Senior Men Pro 1/2"
assert_text_not_present "regexp:Template is missing|Unknown action|Routing Error|RuntimeError|error occurred|Application Trace|RecordNotFound"
assert_not_title "regexp:Exception"

click "result_#{Event.find_by_name('Copperopolis Road Race').standings.first.races.first.results.first.id}_place"
wait_for_element_present "css=.editor_field"
type "css=.editor_field", "DNF"
submit "css=.inplaceeditor-form"
wait_for_element_not_present "css=.editor_field"

refresh_and_wait
assert_text_not_present "13"
assert_text_present "DNF"

click "result_#{Event.find_by_name('Copperopolis Road Race').standings.first.races.first.results.first.id}_name"
wait_for_element_present "css=.editor_field"
type "css=.editor_field", "Megan Weaver"
submit "css=.inplaceeditor-form"
wait_for_element_not_present "css=.editor_field"

refresh_and_wait
assert_text_not_present "Ryan Weaver"
assert_text_present "Megan Weaver"

click "result_#{Event.find_by_name('Copperopolis Road Race').standings.first.races.first.results.first.id}_team_name"
wait_for_element_present "css=.editor_field"
type "css=.editor_field", "River City"
submit "css=.inplaceeditor-form"
wait_for_element_not_present "css=.editor_field"

refresh_and_wait
assert_text_present "River City"

click "result_#{Event.find_by_name('Copperopolis Road Race').standings.first.races.first.results.first.id}_add"
click "result_#{Event.find_by_name('Copperopolis Road Race').standings.first.races.first.results.first.id}_destroy"
wait_for_element_not_present "result_#{Event.find_by_name('Copperopolis Road Race').standings.first.races.first.results.first.id.id}_add"
refresh_and_wait
assert_text_not_present "Megan Weaver"
assert_text_present "DNF"

click "result__add"
wait_for_element_present "//table[@id='results_table']//tr[1]"
refresh_and_wait
assert_text_present "Field Size (2)"
