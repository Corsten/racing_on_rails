include_partial 'fixtures'

open '/teams'
assert_no_text 'error'
assert_no_text 'Unknown action'

@gl_id = Team.find_by_name("Gentle Lovers").id
click "css=a[href='/teams/#{@gl_id}']", :wait_for => :page
assert_no_text 'error'
assert_no_text 'Unknown action'

include_partial 'admin_login'

open '/admin/teams'
assert_text_present "Enter part of a team's name"
type "name", "e"
submit_and_wait("search_form")

assert_text "warn", ""
assert_text "notice", ""

assert_table "teams_table", 1, 0, "glob:Gentle Lovers*"
assert_table "teams_table", 2, 0, "glob:Team dFL*"
assert_table "teams_table", 3, 0, "glob:Vanilla*"

assert_table "teams_table", 1, 1, "glob:Gentile Lovers*"
assert_table "teams_table", 2, 1, ""
assert_table "teams_table", 3, 1, "glob:Vanilla Bicycles*"

@dfl_id = Team.find_by_name("Team dFL").id
@vanilla_id = Team.find_by_name("Vanilla").id
assert_checked "team_member_#{@dfl_id}"
assert_checked "team_member_#{@vanilla_id}"
assert_checked "team_member_#{@gl_id}"

click "team_member_#{@gl_id}"
wait_for_not_checked "team_member_#{@gl_id}"
refresh_and_wait
assert_not_checked "team_member_#{@gl_id}"

click "css=a[href='/results/team/#{@dfl_id}']", :wait_for => :page
assert_text_present "Team dFL"
assert_no_text 'error'
assert_no_text 'Unknown action'

open '/admin/teams'
click "css=a[href='/admin/teams/#{@vanilla_id}/edit']", :wait_for => :page
assert_text_present "Vanilla"
assert_no_text 'error'
assert_no_text 'Unknown action'

type "team_name", "SpeedVagen"
click_and_wait("save")
assert_text_present "SpeedVagen"
assert_no_text 'error'
assert_no_text 'Unknown action'
