<% @page_title = 'Admin: Teams' %>

<%= render :partial => "shared/search", :locals => { :name => @name } %>

<%= table :class => "teams top_margin clear", :id => :teams do %>
  <tr>
    <th class="icon"/>
    <th class="name">Name</th>
    <th>Aliases</th>
    <th class="check_box">Member</th>
    <th class="last actions"></th>
  </tr>
  <%= render :partial => "team", :collection => @teams %>
  <% if @teams.empty? %>
  <tr>
    <%- if @name.blank? -%>
    <td colspan="5" class="not_found">Enter part of a team's name</td>
    <%- else -%>
    <td colspan="5" class="not_found">No teams found</td>
    <%- end -%>
  </tr>
  <% end %>
<% end -%>

<div class="buttons container">
  <%= link_to(image_tag('/images/icons/group_add.png'), { :action => 'new' }, { :class => "image" }) %>
</div>

<%= javascript_tag do %>
  $(document).ready(function() {
  <%- @teams.each do |team| -%>
    $(<%= "'#team_#{team.id}'" %>).draggable({ 
      revert: 'invalid', 
      opacity: 0.7,
      zIndex: 10000,
      helper: function(event) {
        return $('<div class="team">' + $(this).attr('data-name') + '</div>');
      }
    });
    $(<%= "'#team_#{team.id}_row'" %>).droppable({
      hoverClass: 'hovering',
      drop: function(event, ui) {
        ui.helper.hide('scale');
        ui.draggable.closest('tr').hide('fade');
        $(this).addClass('merging');
        $.ajax({
          url: '/admin/teams/merge?target_id=<%= team.id %>',
          type: 'POST',
          data: ({id: ui.draggable.attr('id')}),
          dataType: 'script'
        });
      }
    });
  <% end -%>
  });
<%- end -%>
