<% @page_title = "Results: #{@event.date.year}: #{@event.full_name}" %>

<h2><%= public_link_to_flyer @event %></h2>

<div class="row-fluid event_info">
  <%= @event.city_state %><br/>
  <%- if @event.multiple_days? -%>
    <%= @event.date_range_long_s %>
  <%- else -%>
    <%= @event.date.to_formatted_s(:long) %>
  <%- end -%>

  <%- if @event.parent -%>
  <p>Part of the <%= link_to @event.parent.name, event_results_path(@event.parent) %></p>
  <%- end -%>
</div>

<% unless @event.children_and_child_competitions_with_results.select { |child| child.is_a?(SingleDayEvent) }.empty? -%>
<div class="row-fluid event_info">  
  <table class="child_single_day_events">
    <% @event.children_and_child_competitions_with_results.select { |child| child.is_a?(SingleDayEvent) }.each do |child| -%>
    <tr>
      <td class="date"><%= link_to child.date.strftime('%A, %B %-d'), event_results_path(child) %></td>
      <td class="event"><%= link_to child.name, event_results_path(child), { :class => "obvious" } %></td>
    </tr>
    <% child.children_and_child_competitions_with_results.each do |child_child| -%>
      <tr>
        <td></td>
        <td class="child"><%= link_to child_child.name, event_results_path(child_child) %></td>
      </tr>
      <% end -%>
    <% end -%>
  </table>
</div>
<% end -%>

  <%= render :partial => "races", :object => @event %>

  <%- unless @event.children_and_child_competitions_with_results.select { |child| !child.is_a?(SingleDayEvent) }.empty? -%>
<div class="row-fluid event_info child_events">
  <%- @event.children_and_child_competitions_with_results.select { |child| !child.is_a?(SingleDayEvent) }.each do |child| -%>
  <%= link_to child.name, event_results_path(child), { :class => "obvious" } %><br/>
  <%- end -%>
</div>
  <%- end -%>

  <%- if @event.notes.present? -%>
  <p class="event_notes"><%= @event.notes.html_safe -%></p>
  <%- end -%>

  <% unless @event.races_with_results.empty? -%>
  <p class="created_updated">Updated <%= @event.updated_at.to_formatted_s(:long_and_friendly_date_and_time) %></p>
  <% end -%>

  <% benchmark("Render results", :silence => false) do %>
  <% @event.races_with_results.sort.each do |race| %>
  <h3 class="race" id="race_<%= race.id %>"><%= race.name %></h3>
  <%= results_table race %>
<%- end -%>
<%- end -%>

<%= render "start_list" %>
