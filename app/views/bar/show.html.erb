<% if @race
     @page_title = "BAR: #{@race.year}: #{@race.discipline}: #{@race.category.name}"
   else
     @page_title = "BAR"
   end  -%>

<%= render :partial => "years", :locals => { :overall_bar => @overall_bar, :race => @race } %>
<%= render :partial => "disciplines", :locals => { :overall_bar => @overall_bar, :race => @race } %>

<% if @race && @race.results.any? -%>
<h2><%= @race.year %> <%= @race.discipline %> BAR</h2>
<div class="updatedon centered">Updated <%= @race.updated_at.to_formatted_s(:long) %></div>
<% end -%>

<%= render :partial => "races", :locals => { :race => @race } %>

<% if @race.nil? || @race.results.empty? %>
No results for <%= params[:year] %>
<% else %>

<% table :caption => @race.name do %>
  <tr><th>&nbsp;</th></tr>
  <tr>
    <% if @race.discipline == Discipline[:team] %>

    <td><pre><%- for result in @results.sort %>
<%= result.place.rjust(3) -%>
   <%= link_to(truncate(result.team_name, :length => 40), event_team_results_path(@race.event, result.team)) %><%= ' ' * (40 - (truncate(result.team_name, :length => 40).length)) -%>
   <%= number_with_precision(result.points, :precision => 1).rjust(6) -%>
<%- end -%></pre></td>

    <% else %>

    <td><pre><%- 
  previous_place = nil
  for result in @results.sort %>
<%= 
  if previous_place != result.place 
    result.place.rjust(3) 
  else
    '   '
  end
-%>
 <%- previous_place = result.place -%>
 <%= link_to(truncate(result.name), event_person_results_path(@race.event, result.person)) %><%= ' ' * (30 - truncate(result.name).length) -%>
   <%= truncate(result.team_name, :length => 40).ljust(40) -%>
   <%= number_with_precision(result.points, :precision => 1).rjust(6) -%>
<%- end -%></pre></td>

    <% end %>
  </tr>
  <% end %>  

<% end %>  
